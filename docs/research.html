<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>research – Qingyin Cai</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5bf7ca59d8cc7f7a8155307016a58e21.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Qingyin Cai</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./research.html" aria-current="page"> 
<span class="menu-text">RESEARCH</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./teaching.html"> 
<span class="menu-text">TEACHING</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./resources.html"> 
<span class="menu-text">RESOURCES</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./CV_Cai.pdf" target="_blank"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<div class="column-page">
<section id="working-papers" class="level2">
<h2 class="anchored" data-anchor-id="working-papers">Working Papers</h2>
<details>
<summary style="color: black;">
<strong>Drought and Fresh Produce Production in California</strong> (with Metin Çakır and Timothy Beatty) <br> <em>R &amp; R at Agricultural Economics</em>
</summary>
<u>Abstract</u>: California’s increasingly frequent and intense drought is a pressing problem for the state’s agriculture and the U.S. food supply, as the state is the major producer of many agricultural products. Particularly, California supplies more than half of all fruit and vegetables in the country. This paper examines the severity of the problem by estimating the impacts of the drought on California’s fresh fruit and vegetable production. We estimate panel data models using comprehensive, county-level agriculture, irrigation, and weather data from 2000 to 2019. Our findings indicate that droughts significantly reduce total output, ranging from 1.2% to 2.2% for each additional week of drought. The estimated effect is driven by lower yields and fewer harvested acres due to the drought. The drought effects also differ among crops, with thirsty crops and crops with lower economic returns and established insurance programs being disproportionately affected. Results also show the extent to which higher irrigation levels mitigate the adverse effects of drought. Our findings provide insights into the importance of enhancing drought-related risk management and implications for designing cost-effective policies for future adaptation decisions.
</details>
<details>
<summary style="color: black;">
<strong>Drought and Farm Consolidation: Long-Run Evidence from U.S. Agriculture</strong> (with Metin Çakır)
</summary>
<u>Abstract</u>: In this study, we examine the long-run impacts of drought on farm consolidation in the U.S. crop sector from 1982-2022. Using four decades of county-level data and a long-difference design, we find that cumulative drought exposure significantly increases farm size, primarily through the exit of smaller farms. Effects are strongest in rainfed regions and among field crops, while specialty crop areas show weaker or negative responses to drought. These findings highlight drought as a structural force in U.S. agriculture and underscore the need for targeted climate adaptation policies.
</details>
<details>
<summary style="color: black;">
<strong>California Drought, Fresh Fruit and Vegetable Prices, and Consumer Welfare</strong> (with Metin Çakır, Timothy Beatty, and Timothy Park)
</summary>
<u>Abstract</u>: California produces more than a third of all vegetables and two-thirds of all fruits and nuts in the United States and is the largest producer of over fifty fruits, vegetables, and tree nuts. Meanwhile, California agriculture faces important challenges due to sustained drought with increasing frequency and severity across the state since 2011. This article estimates the effect of the recent California drought on the retail prices of fresh fruits and vegetables (FFV) using panel data models. We build a dataset comprising detailed information on FFV prices and the drought. Specifically, we construct a monthly panel price index for fresh fruits and vegetables using retail scanner data and obtain California’s county-level historical drought data from the United States Drought Monitor. In our estimation, we account for the heterogeneous effects of the drought across products and space. Our main finding is that the drought had a positive and significant effect on FFV prices. This effect is generally larger on fruits than vegetables and is robust to alternative measures of drought and model specifications. Furthermore, we find that the drought’s impacts on production and imports are among the significant determinants of its overall effect on prices.
</details>
<details>
<summary style="color: black;">
<strong>Does the Recent Food Price Inflation Differ by Store Format?</strong> (with Metin Çakır and Megan Sweitzer)
</summary>
<u>Abstract</u>: Recent spikes in food prices have raised significant economic concerns in the United States. Understanding how food price inflation varies across store formats provides valuable insights into consumer behavior and the strategies retailers employ during economic downturns. In this study, we use retail scanner data to construct price indices by store format for various food product groups, allowing us to estimate differences in the rates of price changes across stores. We then estimate a structural store-choice model to examine how these differential rates of price changes affect consumers’ preferences for different store formats. Our findings reveal that food price inflation rates vary significantly by store format, with nontraditional stores generally experiencing lower inflation rates than traditional stores across most food categories. These differential price changes also influence consumer store and product choices.
</details>
<details>
<summary style="color: black;">
<strong>Emotional Shocks and Consumer Spending</strong> (with Qingxiao Li) <br> <em>R &amp; R at Journal of Economic Behavior &amp; Organization</em>
</summary>
<u>Abstract</u>: This study examines how emotional shocks affect consumer spending by using unexpected National Football League (NFL) game outcomes as a natural experiment. We analyze consumer scanner data from 83,332 households during regular seasons from 2004 to 2019, using Las Vegas pregame point spreads and actual outcomes to identify emotional shocks. We find that unexpected losses by home teams increase household shopping trips and spending, while unexpected wins reduce spending. These emotional impacts are concentrated within three days post-game and amplified for high-stakes games. These findings provide insights into how emotional shocks from unexpected events can influence consumer spending behavior.
</details>
<details>
<summary style="color: black;">
<strong>Bad Air Days: Pollution, Forecasts, and Consumer Shopping Behavior</strong> (with Qingxiao Li and Lifeng Ren)
</summary>
<u>Abstract</u>: This paper provides nationwide evidence of how short-term exposure to fine particulate matter causally affects household retail shopping behavior in the United States. Linking detailed household transaction records with daily air quality data, we employ an instrumental-variable strategy that exploits exogenous, wind-driven variation in pollution. We find that air pollution reduces both store visits and retail spending. Consumers disproportionately reduce purchases of nonessential goods and partially shift toward online shopping. Higher-income and younger households show greater avoidance, whereas vulnerable groups show limited capacity to adjust. Using air-quality forecasts, we find evidence of strategic intertemporal substitution, with consumers increasing current shopping when poor air quality is forecasted. Our findings reveal that air pollution generates behavioral responses in consumption, with implications for environmental policy and information provision.
</details>
<details>
<summary style="color: black;">
<strong>Moral Hazard in Agricultural Insurance - Evidence from Non-Voluntary Sow Insurance Program in China</strong> (with Xudong Rao and Yuehua Zhang) <br> <em>Conditionally accepted at Australian Journal of Agricultural and Resource Economics</em>
</summary>
<u>Abstract</u>: Agricultural insurance has not yet lived up to its full potential despite its apparent benefits to agricultural producers. Moral hazard is suspected to be a major obstacle to the adoption of agricultural insurance, especially livestock insurance. In this study, we take advantage of a government-supported, non-voluntary sow insurance program in China and examine whether farmers being aware of having insurance coverage leads to their hazardous behaviors. We estimate these impacts by using an endogenous treatment effects model which controls for endogeneity in our treatment variable. Our results are robust and suggest that farmers’ awareness of their insurance enrollment led to statistically and economically significant differences in their sow mortality rates. Therefore, our results demonstrate the presence of hazardous behavior.
</details>
<details>
<summary style="color: black;">
<strong>How Importance is Junior High School Education Early in Life to Cognitive Outcomes of Elderlies: Evidence from A Quasi-Experiment in China</strong> (with Wen You and Yuehua Zhang)
</summary>
<u>Abstract</u>: As an important part of mental health, cognitive outcomes play a vital role in the quality of life for older adults. Identifying potential early life factors that can influence cognitive outcomes at older ages is of great public health importance. We examine the impact of obtaining junior high education early in life on the cognitive abilities of elderly individuals using a wave of longitudinal data set, the China Health and Retirement Longitudinal Study. We leverage the Cultural Revolution of 1966-1968 as a quasi-experiment identification strategy since this political event almost completely closed down junior high schools in China and created exogenous shocks to the relevant generation’s junior high education experience. We employed the instrumental variable and regression discontinuity methods using this political event as an instrument and discontinuity threshold respectively. Empirical results show that respondents who successfully obtained junior high school education early in life showed higher scores on all cognitive tests in later life. This research further excavates the long-term impact of the Cultural Revolution and provides evidence to support junior high education completion policies and programs for children.
</details>
</section>
<section id="work-in-progress" class="level2">
<h2 class="anchored" data-anchor-id="work-in-progress">Work in Progress</h2>
<p><strong>Extreme Weather Events and Farm Consolidation in the United States</strong> (with Metin Çakır)</p>
<p><strong>Unintended Doses: How Livestock Insurance Fuels Antibiotic Use on Chinese Hog Farms?</strong>(with Xudong Rao, Xingguo Wang, and Calum Turvey)</p>
<p><strong>Societal Preferences for Donation to Rare Diseases: A Discrete Choice Experiment</strong> (with Wen Lin and Yuehua Zhang)</p>
</section>
<section id="publication" class="level2">
<h2 class="anchored" data-anchor-id="publication">Publication</h2>
<p><strong>Qingyin Cai</strong>, Yulian Ding, Calumn Turvey, and Yuehua Zhang (2021). “The Influence of Past Experience on Farmers’ Preferences for Hog Insurance Products: a Natural Experiment and Choice Experiment in China.” <em>The Geneva Papers on Risk and Insurance - Issues and Practice</em>, 46: 399-421. <a href="https://link.springer.com/article/10.1057/s41288-021-00209-7">[Link]</a></p>


</section>
</div>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>